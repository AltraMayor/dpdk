# Generating Packets on DPDK Interfaces

This document describes how to install and use the DPDK pktgen program to generate packets on the XIA server.

First, obtain the pktgen source code and build it:

    $ git clone http://dpdk.org/git/apps/pktgen-dpd
    $ cd pktgen-dpdk
    $ make

Once it compiles, do a setup step:

    $ sudo -E ./setup.sh

The application should be ready to run at this point, but I also encountered the need to perform the following step (still in the pktgen-dpdk directory):

    $ cp Pktgen.lua app/app/x86_64-native-linuxapp-gcc/

Then go to the application directory and run it:

    $ cd app/app/x86_64-native-linuxapp-gcc/
    $ sudo ./pktgen -c 0x3 -n 2 --socket-mem 256 -- -P -m "1.0"

This command runs pktgen with lcores 0 and 1. "1:0" specifies that lcore1 will handle the traffic on port 0. lcore 0 is automatically assigned to the pktgen program. When you run it, some text will flash by showing the setup, and then only the packet generation numbers will be displayed. However, if you scroll up, you can verify the setup and should see "Display processing on lcore 0" means that lcore 0 will handle processing the pktgen program itself, and "RX/TX processing lcore 1 rxcnt 1 txcnt 1 port/qid, 0/0" means that lcore 1 is handling rx/tx traffic on port 0.

More information about the command-line parameters is here: <http://pktgen.readthedocs.io/en/latest/usage_pktgen.html>.

You can start packets flowing on port 0 using:

    $ Pktgen> start 0

And stop them:

    $ Pktgen> stop 0

And quit:

    $ Pktgen> quit

## Known Issues

I have not yet figured out how to make the packets generated by this application be delivered to another DPDK application. The ports and lcores used by each application need to be configured correctly, and when you run two DPDK applications at the same time, you need to limit the amount of memory they can use and give them a unique file prefix.
